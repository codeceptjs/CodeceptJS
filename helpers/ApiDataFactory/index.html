<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="/images/cjs-favicon.png">

	<title>ApiDataFactory - CodeceptJS</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">

        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-30075781-3', 'auto');
            ga('send', 'pageview');
        </script>
        
        <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900" rel="stylesheet" />
<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700' rel='stylesheet' type='text/css'>
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">

        <div class="right hidden-sm hidden-xs hidden-md" style="margin-left: 10px; margin-top: 10px; margin-right: 5px; float:right; text-align: right">
            <a href="https://twitter.com/CodeceptJS" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @CodeceptJS</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>

    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">CodeceptJS</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                
                <li >
                    <a href="../..">Index</a>
                </li>
                
            
            
            
                
                <li >
                    <a href="../../quickstart/">Quickstart</a>
                </li>
                
            
            
            
                
                <li >
                    <a href="../../video/">Video</a>
                </li>
                
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../basics/">Basics</a>
                        </li>
                    
                        <li >
                            <a href="../../acceptance/">Acceptance Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../angular/">Protractor Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../mobile/">Mobile Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../puppeteer/">Puppeteer Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../nightmare/">Nightmare Testing</a>
                        </li>
                    
                        <li >
                            <a href="../">Helpers</a>
                        </li>
                    
                        <li >
                            <a href="../../pageobjects/">Page Objects</a>
                        </li>
                    
                        <li >
                            <a href="../../data/">Data Management</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/">Advanced Usage</a>
                        </li>
                    
                        <li >
                            <a href="../../hooks/">Plugins & Hooks</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Helpers <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../WebDriverIO/">WebDriverIO</a>
                        </li>
                    
                        <li >
                            <a href="../Protractor/">Protractor</a>
                        </li>
                    
                        <li >
                            <a href="../Puppeteer/">Puppeteer</a>
                        </li>
                    
                        <li >
                            <a href="../Nightmare/">Nightmare</a>
                        </li>
                    
                        <li >
                            <a href="../Appium/">Appium</a>
                        </li>
                    
                        <li >
                            <a href="../REST/">REST</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">ApiDataFactory</a>
                        </li>
                    
                        <li >
                            <a href="../FileSystem/">FileSystem</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../installation/">Installation</a>
                        </li>
                    
                        <li >
                            <a href="../../commands/">Commands</a>
                        </li>
                    
                        <li >
                            <a href="../../locators/">Locators</a>
                        </li>
                    
                        <li >
                            <a href="../../configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../../reports/">Reports</a>
                        </li>
                    
                        <li >
                            <a href="../../translation/">Translation</a>
                        </li>
                    
                        <li >
                            <a href="../../docker/">Docker</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                
                <li >
                    <a href="../../changelog/">Releases</a>
                </li>
                
            
            

            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Support  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="https://join.slack.com/t/codeceptjs/shared_invite/enQtMzA5OTM4NDM2MzA4LTNiMTE5YzNlMjQyNWYwZjAzODE3ZTI1MmVkYjY0YTYyNDZmMWJjM2VlODg3NTQzYzM2OGE5ZmIwODFjODk1MzI">Slack</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/codeceptjs?mixed=1">Stack Overflow</a></li>
                    <li><a href="https://twitter.com/codeceptjs">Twitter</a></li>
                    <li><a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&utm_medium=top_2&utm_term=link&utm_campaign=reference">Enterprise Support</a></li>
                </ul>
            </li>

            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">

                    <li class="dropdown promo">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                Services  <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&utm_medium=top_2&utm_term=link&utm_campaign=reference">Consulting &raquo;</a></li>
                                <li><a href="http://sdclabs.com/trainings/web-automation-codeceptjs?utm_source=codecept.io&utm_medium=top_menu&utm_term=link&utm_campaign=reference">Trainings &raquo;</a></li>
                                <li><a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&utm_medium=top_1&utm_term=link&utm_campaign=reference">Test Automation &raquo;</a></li>
                            </ul>
                        </li>



                <li >
                    <a rel="prev" href="../FileSystem/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/codeception/codeceptjs/">
                        
                            <img src="/images/github.png" style="height: 1.2em;" alt="">
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        <div class="banner">
  <strong>CodeceptJS 1.2 released</strong>. What's new:
  <a href="https://codecept.io/acceptance/#multiple-sessions">Multiple browser sessions</a> |
  <a href="https://codecept.io/advanced/#parallel-execution">Parallel execution</a> |
  <a href="https://codecept.io/locators">Locator Builder</a> |
  <a href="https://codecept.io/changelog/#120">Full changelog &raquo;</a>
</div>


        

        <div class="reference">
            <div class="well col-md-3"><div class="bs-sidebar hidden-print" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#apidatafactory">ApiDataFactory</a></li>
        
            <li><a href="#use-case">Use Case</a></li>
        
            <li><a href="#_fetchid">_fetchId</a></li>
        
            <li><a href="#_requestcreate">_requestCreate</a></li>
        
            <li><a href="#_requestdelete">_requestDelete</a></li>
        
            <li><a href="#have">have</a></li>
        
            <li><a href="#havemultiple">haveMultiple</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-7" role="main">

<h1 id="apidatafactory">ApiDataFactory</h1>
<p>Helper for managing remote data using REST API.
Uses data generators like <a href="https://github.com/rosiejs/rosie">rosie</a> or factory girl to create new record.</p>
<p>By defining a factory you set the rules of how data is generated.
This data will be saved on server via REST API and deleted in the end of a test.</p>
<h2 id="use-case">Use Case</h2>
<p>Acceptance tests interact with a websites using UI and real browser.
There is no way to create data for a specific test other than from user interface.
That makes tests slow and fragile. Instead of testing a single feature you need to follow all creation/removal process.</p>
<p>This helper solves this problem.
Most of web application have API, and it can be used to create and delete test records.
By combining REST API with Factories you can easily create records for tests:</p>
<pre><code class="js">I.have('user', { login: 'davert', email: 'davert@mail.com' });
let id = await I.have('post', { title: 'My first post'});
I.haveMultiple('comment', 3, {post_id: id});
</code></pre>

<p>To make this work you need</p>
<ol>
<li>REST API endpoint which allows to perform create / delete requests and</li>
<li>define data generation rules</li>
</ol>
<h3 id="setup">Setup</h3>
<p>Install <a href="https://github.com/rosiejs/rosie">Rosie</a> and <a href="https://www.npmjs.com/package/faker">Faker</a> libraries.</p>
<pre><code class="sh">npm i rosie faker --save-dev`
</code></pre>

<p>Create a factory file for a resource.</p>
<p>See the example for Posts factories:</p>
<pre><code class="js">// tests/factories/posts.js

var Factory = require('rosie').Factory;
var faker = require('faker');

module.exports = new Factory()
   // no need to set id, it will be set by REST API
   .attr('author', () =&gt; faker.name.findName())
   .attr('title', () =&gt; faker.lorem.sentence())
   .attr('body', () =&gt; faker.lorem.paragraph());
</code></pre>

<p>For more options see <a href="https://github.com/rosiejs/rosie">rosie documentation</a>.</p>
<p>Then configure ApiDataHelper to match factories and REST API:</p>
<h3 id="configuration">Configuration</h3>
<p>ApiDataFactory has following config options:</p>
<ul>
<li><code>endpoint</code>: base URL for the API to send requests to.</li>
<li><code>cleanup</code>: should inserted records be deleted up after tests. Default: true</li>
<li><code>factories</code>: list of defined factories</li>
<li><code>REST</code>: configuration for REST requests</li>
</ul>
<p>See the example:</p>
<pre><code class="js"> &quot;ApiDataFactory&quot;: {
   &quot;endpoint&quot;: &quot;http://user.com/api&quot;,
   &quot;cleanup&quot;: true,
   &quot;factories&quot;: {
     &quot;post&quot;: {
        &quot;uri&quot;: &quot;/posts&quot;
        &quot;factory&quot;: &quot;./factories/post&quot;
     },
     &quot;comment&quot;: {
       &quot;factory&quot;: &quot;./factories/comment&quot;,
       &quot;create&quot;: { &quot;post&quot;: &quot;/comments/create&quot; },
       &quot;delete&quot;: { &quot;post&quot;: &quot;/comments/delete&quot; }
     }
   }
}
</code></pre>

<p>It is required to set REST API <code>endpoint</code> which is the baseUrl for all API requests.
Factory file is expected to be passed via <code>factory</code> option.</p>
<p>This Helper uses <a href="http://codecept.io/helpers/REST/">REST</a> helper and accepts its configuration in "REST" section.
So, in order to set default headers or timeout you should add:</p>
<pre><code class="js">&quot;ApiDataFactory&quot;: {
   &quot;REST&quot;: {
     &quot;timeout&quot;: &quot;100000&quot;,
     &quot;defaultHeaders&quot;: {
       &quot;auth&quot;: &quot;111111&quot;
     }
  }
}
</code></pre>

<h3 id="api-requests">Api Requests</h3>
<p>By default to create a record ApiDataFactory will use endpoint and plural factory name:</p>
<ul>
<li>create: <code>POST {endpoint}/{resource} data</code></li>
<li>delete: <code>DELETE {endpoint}/{resource}/id</code></li>
</ul>
<p>Example (<code>endpoint</code>: <code>http://app.com/api</code>):</p>
<ul>
<li>create: POST request to <code>http://app.com/api/users</code></li>
<li>delete: DELETE request to <code>http://app.com/api/users/1</code></li>
</ul>
<p>However this behavior can be configured with following options:</p>
<ul>
<li><code>uri</code>: set different resource uri. Example: <code>uri: account</code> =&gt; <code>http://app.com/api/account</code>.</li>
<li><code>create</code>: override create options. Expected format: <code>{ method: uri }</code>. Example: <code>{ "post": "/users/create" }</code></li>
<li><code>delete</code>: override delete options. Expected format: <code>{ method: uri }</code>. Example: <code>{ "post": "/users/delete/{id}" }</code></li>
</ul>
<p><strong>Parameters</strong></p>
<ul>
<li><code>config</code>  </li>
</ul>
<h2 id="_fetchid">_fetchId</h2>
<p>Fetches id of a record after it was created by <code>have</code>.
By default fetched <code>id</code> attribute from JSON body.</p>
<p>Customize it from custom Helper file:</p>
<pre><code class="js">this.helpers['ApiDataFactory']._fetchId = (body, factory) {
   return body[factory][0].id;
}
</code></pre>

<p><strong>Parameters</strong></p>
<ul>
<li><code>body</code> <strong>Any</strong> </li>
<li><code>factory</code> <strong>Any</strong> </li>
</ul>
<h2 id="_requestcreate">_requestCreate</h2>
<p>Executes request to create a record in API.
Can be replaced from a in custom helper.</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>factory</code> <strong>Any</strong> </li>
<li><code>data</code> <strong>Any</strong> </li>
</ul>
<h2 id="_requestdelete">_requestDelete</h2>
<p>Executes request to delete a record in API
Can be replaced from a custom helper.</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>factory</code> <strong>Any</strong> </li>
<li><code>id</code> <strong>Any</strong> </li>
</ul>
<h2 id="have">have</h2>
<p>Generates a new record using factory and saves API request to store it.</p>
<pre><code class="js">// create a user
I.have('user');
// create user with defined email
I.have('user', { email: 'user@user.com'});
</code></pre>

<p><strong>Parameters</strong></p>
<ul>
<li><code>factory</code> <strong>Any</strong> factory to use</li>
<li><code>params</code> <strong>Any</strong> predefined parameters</li>
</ul>
<h2 id="havemultiple">haveMultiple</h2>
<p>Generates bunch of records and saves multiple API requests to store them.</p>
<pre><code class="js">// create 3 posts
I.have('post', 3);

// create 3 posts by one author
I.have('post', 3, { author: 'davert' });
</code></pre>

<p><strong>Parameters</strong></p>
<ul>
<li><code>factory</code> <strong>Any</strong> </li>
<li><code>times</code> <strong>Any</strong> </li>
<li><code>params</code> <strong>Any</strong> </li>
</ul></div>
            <div class="col-md-2" class="promo-1">
    <div class="promo-banner"  >
                <h3>
                    Enterprise Support
                </h3>

                <p>We help you to develop efficient end to end tests
                    <a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&utm_medium=right&utm_term=link&utm_campaign=reference">Learn More &raquo;</a>
                </p>
    </div>

</div>
            <div class="clearfix"></div>
        </div>
        

     <footer>
        <div class="container">
          <div class="row">
            <div class="col-md-4">
                <h5>Support:</h5>
                <ul>
                    <li><a href="https://join.slack.com/t/codeceptjs/shared_invite/enQtMzA5OTM4NDM2MzA4LTNiMTE5YzNlMjQyNWYwZjAzODE3ZTI1MmVkYjY0YTYyNDZmMWJjM2VlODg3NTQzYzM2OGE5ZmIwODFjODk1MzI">Slack Channel</a></li>
                    <li><a href="https://stackoverflow.com/questions/tagged/codeceptjs?mixed=1">Stack Overflow</a></li>
                    <li><a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&utm_medium=bottom&utm_term=link&utm_campaign=reference">Commercial Support</a></li>
                </ul>

            </div>

<div class="col-md-4">
          <ul class="imglist">
                    <li class="github"><a href="https://github.com/codeception/codeceptjs"><img src="/images/github.png" alt="GitHub">Codeception/CodeceptJS</a></li>
                    <li class="twitter">
                        <a  href="https://twitter.com/codeceptjs">
                            <img src="/images/twitter.png" alt="">@CodeceptJS
                        </a>
                    </li>
                    </ul>

</div>

            <div class="col-md-4">




                <h4>Our Contributors</h4>
                <div id="contributors"></div>
            </div>

        </div>


        <center>Created by <strong>CodeceptJS Team</strong></center>

</div>

    </footer>


        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>

    </body>
</html>